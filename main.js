(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{wg:()=>F,N_:()=>V,xS:()=>B});var t=document.querySelector(".profile__button"),n=document.querySelector(".profile__button-plus"),r=document.querySelector(".popup__cross"),o=document.querySelector("#closeButton"),c=document.querySelector(".profile__image");function a(e){"Escape"===e.code&&s.forEach(v)}var u={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19",headers:{authorization:"38e35aea-5cfc-4e58-bba6-375b97d69ebd","Content-Type":"application/json"}},i=document.querySelector(".profile__title"),l=document.querySelector(".profile__subtitle"),s=document.querySelectorAll(".popup"),d=document.querySelector(".popup__form_type_edit"),p=d.querySelector(".popup__text_type_name"),_=d.querySelector(".popup__text_type_job"),f=document.querySelector(".popup__edit-profile"),m=document.querySelector("#submit-edit-text"),h=document.querySelector("#submit-avatar-text");function y(e){e.classList.add("popup_opened"),document.addEventListener("keydown",a)}function v(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",a)}function S(e){e.textContent="Сохранение..."}function q(e){e.textContent="Сохранить"}function b(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var E=document.querySelector("#card-template").content,L=document.querySelector(".elements"),k=document.querySelector(".popup__image"),x=k.querySelector(".popup__image-image"),C=k.querySelector(".popup__image-heading"),g=document.querySelector(".popup__form_type_add"),U=g.querySelector(".popup__text_type_place"),A=g.querySelector(".popup__text_type_link"),O=document.querySelector(".popup__form_type_avatar"),w=document.querySelector(".popup__add-card"),P=document.querySelector("#addButton"),T=document.querySelector("#submit-add-text");function j(e,t,n,r,o){var c=function(e,t,n,r,o){var c=E.querySelector(".elements__wrapper").cloneNode(!0),a=c.querySelector(".elements__element"),i=c.querySelector(".elements__text");a.src=e.link,a.alt=e.alt,i.textContent=e.name,a.addEventListener("click",(function(){y(k),x.src=e.link,C.textContent=e.name,x.alt=e.name}));var l=c.querySelector(".elements__bin");t===B&&(l.style.display="block"),l.addEventListener("click",(function(){(function(e){return fetch("".concat(u.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then(b)})(r).then((function(){c.remove()})).catch((function(e){return"Ошибка:".concat(e)}))}));var s=c.querySelector(".elements__heart");function d(){s.classList.toggle("elements__heart_active")}o.map((function(e){return e._id})).indexOf(B)>=0&&s.classList.add("elements__heart_active");var p=c.querySelector(".elements__likes-counter");return p.textContent=n,s.addEventListener("click",(function(){s.classList.contains("elements__heart_active")||function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:u.headers}).then(b)}(r).then((function(e){return p.textContent=e.likes.length})).then((function(){d()})).catch((function(e){return"Ошибка:".concat(e)})),s.classList.contains("elements__heart_active")&&function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers}).then(b)}(r).then((function(e){return p.textContent=e.likes.length})).then((function(){d()})).catch((function(e){return"Ошибка:".concat(e)}))})),c}(e,t,n,r,o);L.prepend(c)}var B,D,N={formSelector:".popup__form",inputSelector:".popup__text",submitButtonSelector:".popup__button",inputErrorClass:"popup__text_type_error",errorClass:"popup__place-input-error_active"},J=function(e,t){M(e)?t.disabled=!0:t.disabled=!1},M=function(e){return e.some((function(e){return!e.validity.valid}))},H=k.querySelector(".popup__image-cross"),V=document.querySelector("#popup-avatar"),z=V.querySelector("#closeAvatarButton"),F=(V.querySelector("#addAvatarButton"),V.querySelector(".popup__text_type_avatar"));D=N,Array.from(document.querySelectorAll(D.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);J(n,r),n.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".popup__".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,N):function(e,t,n,r){var o=e.querySelector(".popup__".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,N)}(e,t),J(n,r)}))}))}(e,D)})),fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then(b).then((function(e){i.textContent=e.name,l.textContent=e.about,c.src=e.avatar,B=e._id,fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then(b).then((function(e){e.reverse().forEach((function(e){j(e,e.owner._id,e.likes.length,e._id,e.likes)}))})).catch((function(e){"Ошибка:".concat(e)}))})).catch((function(e){return"Ошибка: ".concat(e)})),t.addEventListener("click",(function(){y(f),p.value=i.textContent,_.value=l.textContent})),n.addEventListener("click",(function(){y(w)})),r.addEventListener("click",(function(){v(f)})),o.addEventListener("click",(function(){v(w)})),H.addEventListener("click",(function(){v(k)})),c.addEventListener("click",(function(){y(V)})),z.addEventListener("click",(function(){v(V)})),d.addEventListener("submit",(function(e){var t,n;S(m),e.preventDefault(),(t=p.value,n=_.value,fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:t,about:n})}).then(b)).then((function(e){i.textContent=e.name,l.textContent=e.about,v(f)})).catch((function(e){return"Ошибочка: ".concat(e)})).finally((function(){q(m)}))})),g.addEventListener("submit",(function(e){var t,n;S(T),e.preventDefault(),(t=U.value,n=A.value,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:t,link:n})}).then(b)).then((function(t){j(t,t.owner._id,t.likes.length,t._id,t.likes),v(w),P.disabled=!0,e.target.reset()})).catch((function(e){"Ошибка:".concat(e)})).finally((function(){q(T)}))})),O.addEventListener("submit",(function(e){var t;S(h),e.preventDefault(),(t=F.value,fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:t})}).then(b)).then((function(e){c.src=e.avatar,v(V)})).catch((function(e){return console.log(e)})).finally((function(){q(h)}))})),s.forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&v(e)}))}))})();
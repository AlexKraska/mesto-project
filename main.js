(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{wg:()=>H,N_:()=>J});var t=document.querySelector(".profile__button"),n=document.querySelector(".profile__button-plus"),o=document.querySelector(".popup__cross"),r=document.querySelector("#closeButton"),c=document.querySelector(".profile__image");function a(e){"Escape"===e.code&&_.forEach(q)}var u,i={formSelector:".popup__form",inputSelector:".popup__text",submitButtonSelector:".popup__button",inputErrorClass:"popup__text_type_error",errorClass:"popup__place-input-error_active"},s=document.querySelector(".profile__title"),l=document.querySelector(".profile__subtitle"),d=function(e,t){p(e)?t.disabled=!0:t.disabled=!1},p=function(e){return e.some((function(e){return!e.validity.valid}))};u=i,Array.from(document.querySelectorAll(u.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);d(n,o),n.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".popup__".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,i):function(e,t,n,o){var r=e.querySelector(".popup__".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,i)}(e,t),d(n,o)}))}))}(e,u)}));var f="https://nomoreparties.co/v1/plus-cohort-19",_=document.querySelectorAll(".popup"),m=document.querySelector(".popup__form_type_edit"),y=m.querySelector(".popup__text_type_name"),h=m.querySelector(".popup__text_type_job"),v=document.querySelector(".popup__edit-profile"),b=document.querySelectorAll(".popup__button-text");function S(e){e.classList.add("popup_opened"),y.value=s.textContent,h.value=l.textContent,document.addEventListener("keydown",a)}function q(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",a)}function k(){b.forEach((function(e){e.textContent="Сохранение..."}))}function E(){b.forEach((function(e){e.textContent="Сохранить"}))}var C=document.querySelector("#card-template").content,L=document.querySelector(".elements"),j=document.querySelector(".popup__image"),x=j.querySelector(".popup__image-image"),g=j.querySelector(".popup__image-heading"),P=document.querySelector(".popup__form_type_add"),T=P.querySelector(".popup__text_type_place"),A=P.querySelector(".popup__text_type_link"),z=document.querySelector(".popup__form_type_avatar"),O=document.querySelector(".popup__add-card"),w=document.querySelector("#addButton"),B="d4cd3c3ae287bd684ff7aa5a";function D(e,t,n,o,r){var c=function(e,t,n,o,r){var c=C.querySelector(".elements__wrapper").cloneNode(!0),a=c.querySelector(".elements__element"),u=c.querySelector(".elements__text");a.src=e.link,a.alt=e.alt,u.textContent=e.name,a.addEventListener("click",(function(){S(j),x.src=e.link,g.textContent=e.name,x.alt=e.name}));var i=c.querySelector(".elements__bin");t===B&&(i.style.display="block"),i.addEventListener("click",(function(){(function(e){return fetch("".concat(f,"/cards/").concat(e),{method:"DELETE",headers:{authorization:"38e35aea-5cfc-4e58-bba6-375b97d69ebd","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(o).then(c.remove()).catch((function(e){return"Ошибка:".concat(e)}))}));var s=c.querySelector(".elements__heart");r.map((function(e){return e._id})).indexOf(B)>=0&&s.classList.add("elements__heart_active");var l=c.querySelector(".elements__likes-counter");return l.textContent=n,s.addEventListener("click",(function(){s.classList.contains("elements__heart_active")||function(e){return fetch("".concat(f,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:"38e35aea-5cfc-4e58-bba6-375b97d69ebd","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o).then((function(e){return l.textContent=e.likes.length})).catch((function(e){return"Ошибка:".concat(e)})),s.classList.contains("elements__heart_active")&&function(e){return fetch("".concat(f,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:"38e35aea-5cfc-4e58-bba6-375b97d69ebd","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o).then((function(e){return l.textContent=e.likes.length})).catch((function(e){return"Ошибка:".concat(e)})),s.classList.toggle("elements__heart_active")})),c}(e,t,n,o,r);L.prepend(c)}var N=j.querySelector(".popup__image-cross"),J=document.querySelector("#popup-avatar"),M=J.querySelector("#closeAvatarButton"),H=(J.querySelector("#addAvatarButton"),J.querySelector(".popup__text_type_avatar"));fetch("".concat(f,"/users/me"),{headers:{authorization:"38e35aea-5cfc-4e58-bba6-375b97d69ebd"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s.textContent=e.name,l.textContent=e.about,c.src=e.avatar,fetch("".concat(f,"/cards"),{headers:{authorization:"38e35aea-5cfc-4e58-bba6-375b97d69ebd"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.reverse().forEach((function(e){D(e,e.owner._id,e.likes.length,e._id,e.likes)}))}))})).catch((function(e){return"Ошибка: ".concat(e)})),t.addEventListener("click",(function(){S(v)})),n.addEventListener("click",(function(){S(O)})),o.addEventListener("click",(function(){q(v)})),r.addEventListener("click",(function(){q(O)})),N.addEventListener("click",(function(){q(j)})),c.addEventListener("click",(function(){S(J)})),M.addEventListener("click",(function(){q(J)})),m.addEventListener("submit",(function(e){k(),e.preventDefault(),function(e,t){return fetch("".concat(f,"/users/me"),{method:"PATCH",headers:{authorization:"38e35aea-5cfc-4e58-bba6-375b97d69ebd","Content-Type":"application/json"},body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(y,h).then((function(e){s.textContent=e.name,l.textContent=e.about,q(v),E()})).catch((function(e){return"Ошибочка: ".concat(e)}))})),P.addEventListener("submit",(function(e){k(),e.preventDefault(),function(e,t){return fetch("".concat(f,"/cards"),{method:"POST",headers:{authorization:"38e35aea-5cfc-4e58-bba6-375b97d69ebd","Content-Type":"application/json"},body:JSON.stringify({name:e.value,link:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(T,A).then((function(t){D(t,t.owner._id,t.likes.length,t._id,t.likes),q(O),E(),w.disabled=!0,e.target.reset()})).catch((function(e){"Ошибка:".concat(e)}))})),z.addEventListener("submit",(function(e){k(),e.preventDefault(),function(e){return fetch("".concat(f,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"38e35aea-5cfc-4e58-bba6-375b97d69ebd","Content-Type":"application/json"},body:JSON.stringify({avatar:e.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(H).then((function(e){c.src=e.avatar,q(J),E()})).catch((function(e){return console.log(e)}))})),_.forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&q(e)}))}))})();